<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>控制台-用户</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/main.css">
    <style>

    </style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">后台管理</div>
        <ul class="layui-nav layui-layout-left" lay-filter="leftmenu">
            <li class="layui-nav-item">
                <a href="javascript:;" class="hidetab" title="隐藏左侧菜单"><i class="layui-icon layui-icon-shrink-right"></i></a>
            </li>
        </ul>

        <div class="sys-time">当前系统时间：获取中...</div>
        <div class="weather">
            <div id="tp-weather-widget"></div>
        </div>
        <script>
            (function(a,h,g,f,e,d,c,b){b=function(){d=h.createElement(g);c=h.getElementsByTagName(g)[0];d.src=e;d.charset="utf-8";d.async=1;c.parentNode.insertBefore(d,c)};a["SeniverseWeatherWidgetObject"]=f;a[f]||(a[f]=function(){(a[f].q=a[f].q||[]).push(arguments)});a[f].l=+new Date();if(a.attachEvent){a.attachEvent("onload",b)}else{a.addEventListener("load",b,false)}}(window,document,"script","SeniverseWeatherWidget","//cdn.sencdn.com/widget2/static/js/bundle.js?t="+parseInt((new Date().getTime() / 100000000).toString(),10)));
            window.SeniverseWeatherWidget('show', {
                flavor: "slim",
                location: "WW0V9QP93VS8",
                geolocation: true,
                language: "zh-Hans",
                unit: "c",
                theme: "auto",
                token: "8f358253-700a-4112-856b-5838e57baee5",
                hover: "enabled",
                container: "tp-weather-widget"
            })
        </script>
        <ul class="layui-nav top_menu layui-layout-right" lay-filter="right">
            <li class="layui-nav-item" pc>
                <a href="javascript:;">
                    <img src="../img/header.jpg" class="layui-circle" width="35" height="35">
                    <cite><span class="userName" id="userInfo">获取中...</span></cite>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;" lay-id="info" lay-href="./user/info.html"><i class="iconfont icon-zhanghu"
                                                                                     data-icon="icon-zhanghu"></i><cite>个人资料</cite></a>
                    </dd>
                    <dd><a lay-id="pwd" lay-href="./user/changePwd.html" href="javascript:;"><i class="iconfont icon-shezhi1"
                                                                                      data-icon="icon-shezhi1"></i><cite>修改密码</cite></a>
                    </dd>
                    <dd><li class="confont icon-shezhi1"><a href="login.html"><i class="layui-icon">&#xe602;</i><cite>退出系统</cite></a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-side-menu layui-bg-black">
        <div class="layui-side-scroll">
            <div class="user-photo">
                <a class="img" title="我的头像"><img src="../img/header.jpg" class="userAvatar"></a>
                <p>你好！<span class="userName" id="userName">获取中...</span>, 欢迎登录</p>
            </div>
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-this">
                    <a lay-id="welcome" class="" href="javascript:;" lay-href="welcome.html"><i class="layui-icon">&#xe68e;</i><cite>欢迎界面</cite></a>
                </li>
                <li class="layui-nav-item">
                    <a class="" href="javascript:;"><i class="layui-icon seraph icon-text">&#xe62a;</i><cite>商品管理</cite></a>
                    <dl class="layui-nav-child">
                        <dd><a lay-id="productlist" lay-href="productlist.html" href="javascript:;"><i class="layui-icon">&#xe60a;</i><cite>商品列表</cite></a>
                        </dd>
                        <dd><a lay-id="productcate" lay-href="productcate.html" href="javascript:;"><i class="layui-icon">&#xe62d;</i><cite>商品分类</cite></a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a class="" href="javascript:;"><i class="layui-icon">&#xe629;</i><cite>订单管理</cite></a></a>
                    <dl class="layui-nav-child">
                        <dd><a lay-id="userorderlist" lay-href="userorderlist.html" href="javascript:;"><i
                                class="layui-icon">&#xe629;</i><cite>订单列表</cite></a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a class="" href="javascript:;"><i class="layui-icon">&#xe612;</i><cite>用户管理</cite></a></a>
                    <dl class="layui-nav-child">
                        <dd><a lay-id="userlist" lay-href="userlist.html" href="javascript:;"><i class="layui-icon">&#xe613;</i><cite>用户列表</cite></a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a class="" href="javascript:;"><i class="layui-icon">&#xe612;</i><cite>轮播管理</cite></a></a>
                    <dl class="layui-nav-child">
                    <dd><a lay-id="banner" lay-href="banner.html" href="javascript:;"><i class="layui-icon">&#xe62d;</i><cite>轮播列表</cite></a>
                    </dd>
                    </dl>
                </li>
                <li class="layui-nav-item"><a href="login.html"><i class="layui-icon">&#xe602;</i><cite>退出系统</cite></a>
                </li>
            </ul>
        </div>
    </div>

    <div class="layui-admin-pagetabs">
        <div class="layui-body layui-tab-brief">
            <div class="layui-tab" lay-allowClose="true" lay-filter="demo">
                <ul class="layui-tab-title">
                    <li class="layui-this" lay-id="welcome.html" id="wel">欢迎界面</li>
                </ul>
                <div class="refresh refreshThis">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe669;</i>
                        刷新当前
                    </a>
                </div>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <iframe width="100%" src="welcome.html" class="layui-admin-iframe" scrolling="yes"
                                frameborder="0" onload="setIframeHeight(this);"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-footer footer">
        <p>copyright @2019 kay三石</p>
    </div>
</div>
</body>
<script src="../layui/layui.js"></script>
<script>
    layui.use(['element', 'jquery', 'layer'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var element = layui.element;
        var userinfo = {};

        //获取用户信息
        function checkUser() {
            $.ajax({
                url: '/user',
                dataType: 'json',
                success: function (res) {

                    if (res.code == '1') {
                        layer.msg('未登录或登录信息已失效', {icon: 5, time: 1000}, function () {
                            window.location.href = 'login.html';
                        });
                    } else if (res.code == '0') {
                        userinfo.nick = res.data.nick;
                        userinfo.time = res.data.lastLoginTime;
                        userinfo.ip = res.data.lastLoginIp;
                        loginName();
                    }
                },
                error: function (res) {
                    layer.msg('网络错误', {icon: 2, time: 1000}, function () {
                        window.location.href = 'login.html';
                    });
                }
            });
        }

        //checkUser();

        function loginName() {
            $('#userName').text(userinfo.nick);
            $('#userNameRight').text(userinfo.nick);
        }


        element.on('nav(leftmenu)', function (elem) {
            //隐藏显示侧边菜单
            if (elem[0].className == 'hidetab') {//隐藏
                //侧边菜单伸缩
                $('.layui-side-menu').animate({width: $('.layui-side-menu').width() - 144 + 'px'});
                //正文伸缩
                $('.layui-body').animate({left: $('.layui-body').position().left - 144 + 'px'});
                //底部伸缩
                $('.layui-footer').animate({left: $('.layui-footer').position().left - 144 + 'px'});
                $(this).attr('class', 'showtab');
                $(this).find('i').attr('class', 'layui-icon layui-icon-spread-left');
                //侧边菜单只显示图标
                $('.layui-nav-tree').find('li').each(function (em, ind) {
                    $(this).find('cite').css('display', 'none');
                    $(this).find('dl').css('display', 'none');
                });

                $('.user-photo').css('display', 'none');
            } else if (elem[0].className == 'showtab') {//显示
                $('.layui-side-menu').animate({width: $('.layui-side-menu').width() + 144 + 'px'});
                $('.layui-body').animate({left: $('.layui-body').position().left + 144 + 'px'});
                $('.layui-footer').animate({left: $('.layui-footer').position().left + 144 + 'px'});
                $(this).attr('class', 'hidetab');
                $(this).find('i').attr('class', 'layui-icon layui-icon-shrink-right');
                $('.layui-nav-tree').find('li').each(function (em, ind) {
                    $(this).find('cite').css('display', '');
                    $(this).find('dl').css('display', '');
                });

                $('.user-photo').css('display', '');
            }
        });


        //时间显示
        setInterval(function () {
            var vWeek, vWeek_s, vDay;
            vWeek = ["星期天", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
            var date = new Date();
            year = date.getFullYear();
            month = date.getMonth() + 1;
            day = date.getDate();
            hours = date.getHours();
            hours = hours < 10 ? '0' + hours : hours;
            minutes = date.getMinutes();
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = date.getSeconds();
            seconds = seconds < 10 ? '0' + seconds : seconds;
            vWeek_s = date.getDay();
            $('.sys-time').text(`当前系统时间：${year}年${month}月${day}日 ${hours}:${minutes}:${seconds} ${vWeek[vWeek_s]}`);
            // year + "年" + month + "月" + day + "日" + "\t" + hours + ":" + minutes +":" + seconds + "\t" + vWeek[vWeek_s] ;;
        }, 1000 / 60);

        //左侧导航实现手风琴效果
        var navs = $('.layui-side-scroll .layui-nav-item');

        function navClose() {
            navs.each(function () {
                $(this).removeClass('layui-nav-itemed');
            });
        }

        navs.each(function () {
            $(this).click(function () {
                var flag = $(this).hasClass('layui-nav-itemed') ? true : false;
                navClose();
                if (!flag) $(this).removeClass('layui-nav-itemed');
                else $(this).addClass('layui-nav-itemed');
            });
        });


        element.on('nav(right)', function (elem) {
            if ($(this).attr('lay-href') != undefined) {
                var flag = true;

                var url = $(this).attr('lay-href');
                $('.layui-tab-title li').each(function (i, e) {
                    if ($(this).attr('lay-id') == url) {
                        //切换选项卡
                        element.tabChange('demo', url);
                        hidenWel();
                        flag = false;
                    }
                });
                if (flag) {
                    //新增选项卡
                    element.tabAdd('demo', {
                        title: $(this).text(),
                        content: '<iframe src="' + url + '" height="100%" width="100%" scrolling="yes" frameborder="0" onload="setIframeHeight(this);"></iframe>',
                        id: url
                    });
                    element.tabChange('demo', url);
                    hidenWel();
                }
            }
        });


        //侧边菜单监控
        element.on('nav(test)', function (elem) {
            if ($('.layui-side-menu').width() < 200) {
                $('.layui-side-menu').animate({width: $('.layui-side-menu').width() + 144 + 'px'});
                $('.layui-body').animate({left: $('.layui-body').position().left + 144 + 'px'});
                $('.layui-footer').animate({left: $('.layui-footer').position().left + 144 + 'px'});
                $('.layui-layout-left li:first-child').find('a').attr('class', 'hidetab');
                $('.layui-layout-left li:first-child').find('i').attr('class', 'layui-icon layui-icon-shrink-right');
                $('.layui-nav-tree').find('li').each(function (em, ind) {
                    $(this).find('cite').css('display', '');
                    $(this).find('dl').css('display', '');
                });

                $('.user-photo').css('display', '');
            } else {
                if ($(this).attr('lay-href') != undefined) {
                    var flag = true;

                    var url = $(this).attr('lay-href');
                    $('.layui-tab-title li').each(function (i, e) {
                        if ($(this).attr('lay-id') == url) {
                            //切换选项卡
                            element.tabChange('demo', url);
                            hidenWel();
                            flag = false;
                        }
                    });
                    if (flag) {
                        //新增选项卡
                        element.tabAdd('demo', {
                            title: elem[0].children[1].innerText,
                            content: '<iframe src="' + url + '" height="100%" width="100%" scrolling="yes" frameborder="0" onload="setIframeHeight(this);"></iframe>',
                            id: url
                        });
                        element.tabChange('demo', url);
                        hidenWel();
                    }
                }
            }
        });
        hidenWel();

        function hidenWel() {
            //移除第一个标签的关闭图标
            // $('#wel').children('i').remove();
        }


        //刷新当前页
        $('.refresh').on('click', function () {
            if ($(this).hasClass('refreshThis')) {
                $(this).removeClass('refreshThis');
                $('.layui-tab .layui-tab-item.layui-show').find('iframe')[0].contentWindow.location.reload(true);
                setTimeout(function () {
                    $('.refresh').addClass('refreshThis');
                }, 1000);
            } else {
                layer.msg('点击速度过快，请稍等会');
            }
        });

        window.onresize = function () {
            var iframes = $('.layui-tab-content iframe');
            $.each(iframes, function (indx, iframe) {
                iframe.height = document.querySelector('.layui-admin-pagetabs .layui-body').clientHeight - 60 + 'px';
            });
        };


        //监听选项卡切换
        // element.on('tab()')
    });

    //iframe高度自适应
    function setIframeHeight(iframe) {
        if (iframe) {
            var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;
            if (iframeWin.document.body) {
                // console.log(iframe.height);
                // iframe.height = iframeWin.document.documentElement.scrollHeight || iframeWin.document.body.scrollHeight;
                console.log(document.querySelector('.layui-admin-pagetabs .layui-body').clientHeight);
                iframe.height = document.querySelector('.layui-admin-pagetabs .layui-body').clientHeight - 60 + 'px';
            }

        }

        // return;
    };
</script>
</html>
